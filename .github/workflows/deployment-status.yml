name: Deployment Status\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  pre-deployment:\n    runs-on: ubuntu-latest\n    outputs:\n      issue-number: ${{ steps.create-issue.outputs.issue-number }}\n    steps:\n      - name: Checkout Repository\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 2\n\n      - name: Set Up Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '18'\n          cache: 'npm'\n\n      - name: Install Dependencies\n        run: npm ci\n\n      - name: Run Linter\n        run: npm run lint\n\n      - name: Run Tests\n        run: npm test\n\n      - name: Create Deployment Tracking Issue\n        id: create-issue\n        uses: actions/github-script@v7\n        with:\n          script: |\n            const commitSha = context.sha;\n            const packageVersion = require('./package.json').version;\n            const issue = await github.rest.issues.create({\n              owner: context.repo.owner,\n              repo: context.repo.repo,\n              title: `Deployment Tracking - ${commitSha}`,\n              body: `# Deployment Tracking for Commit ${commitSha}\n\nPackage Version: ${packageVersion}`,\n              labels: ['deployment', 'in-progress']\n            });\n            core.setOutput('issue-number', issue.data.number);\n\n      - name: Post Pre-Deployment Comment\n        uses: actions/github-script@v7\n        with:\n          script: |\n            const issueNumber = ${{ steps.create-issue.outputs.issue-number }};\n            await github.rest.issues.createComment({\n              owner: context.repo.owner,\n              repo: context.repo.repo,\n              issue_number: issueNumber,\n              body: \"âœ… Pre-deployment checks (lint + tests) completed successfully.\"\n            });\n\n  rollback-preparation:\n    needs: pre-deployment\n    runs-on: ubuntu-latest\n    outputs:\n      artifact-name: ${{ env.ARTIFACT_NAME }}\n      sha256-checksum: ${{ env.SHA256_CHECKSUM }}\n    steps:\n      - name: Checkout Repository\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 2\n\n      - name: Set Up Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '18'\n\n      - name: Generate Rollback Artifacts\n        run: |\n          CURRENT_COMMIT=$(git rev-parse HEAD)\n          PREVIOUS_COMMIT=$(git rev-parse HEAD~1)\n          PACKAGE_VERSION=$(node -p "require('./package.json').version")\n          ARTIFACT_NAME="rollback-package-${CURRENT_COMMIT}"\n          cat > rollback.sh << 'EOF'\n          #!/bin/bash\n          set -euo pipefail\n          if [ -z "${PREVIOUS_COMMIT:-}" ]; then echo "ERROR: PREVIOUS_COMMIT required" >&2; exit 1; fi\n          echo "Rolling back to $PREVIOUS_COMMIT..."\n          git checkout "$PREVIOUS_COMMIT" --quiet\n          npm install --force\n          echo "Rollback completed."\n          EOF\n          chmod +x rollback.sh\n          mkdir -p rollback-artifacts\n          cp package.json package-lock.json rollback-artifacts/\n          cat > rollback-artifacts/rollback-docs.md << EOF\n          # Rollback Instructions\n          1. Download artifact: gh run download --name $ARTIFACT_NAME --dir rollback\n          2. Extract: tar -xzf rollback/${ARTIFACT_NAME}.tar.gz -C rollback\n          3. Run: cd rollback && PREVIOUS_COMMIT=$PREVIOUS_COMMIT ./rollback.sh\n          EOF\n          tar -czf "${ARTIFACT_NAME}.tar.gz" rollback.sh rollback-artifacts/\n          SHA256_CHECKSUM=$(sha256sum "${ARTIFACT_NAME}.tar.gz" | awk '{print $1}')\n          echo "ARTIFACT_NAME=${ARTIFACT_NAME}" >> $GITHUB_ENV\n          echo "SHA256_CHECKSUM=${SHA256_CHECKSUM}" >> $GITHUB_ENV\n          echo "PREVIOUS_COMMIT=${PREVIOUS_COMMIT}" >> $GITHUB_ENV\n          echo "CURRENT_COMMIT=${CURRENT_COMMIT}" >> $GITHUB_ENV\n          echo "PACKAGE_VERSION=${PACKAGE_VERSION}" >> $GITHUB_ENV\n\n      - name: Upload Rollback Artifact\n        uses: actions/upload-artifact@v4\n        with:\n          name: ${{ env.ARTIFACT_NAME }}\n          path: ${{ env.ARTIFACT_NAME }}.tar.gz\n          retention-days: 30\n          if-no-files-found: error\n\n      - name: Post Rollback Comment\n        uses: actions/github-script@v7\n        with:\n          script: |\n            const issueNumber = ${{ needs.pre-deployment.outputs.issue-number }};\n            const { ARTIFACT_NAME, SHA256_CHECKSUM, PREVIOUS_COMMIT, CURRENT_COMMIT, PACKAGE_VERSION } = process.env;\n            const commentBody = `\n## ðŸ”„ Rollback Plan Ready\n---\n### Context\nâœ… Previous Commit: \`${PREVIOUS_COMMIT}\`\nâœ… Current Commit: \`${CURRENT_COMMIT}\`\nâœ… Package Version: \`${PACKAGE_VERSION}\`\nâœ… Artifact: \`${ARTIFACT_NAME}.tar.gz\`\nâœ… SHA256: \`${SHA256_CHECKSUM}\`\n\n### Status\nâœ… Rollback script (error-handling)\nâœ… Configuration backups\nâœ… Documentation\nâœ… Compressed artifacts\nâœ… Artifact uploaded\n\n### Quick Rollback\n\`\`\`bash\nexport PREVIOUS_COMMIT=${PREVIOUS_COMMIT}\nexport ARTIFACT_NAME=${ARTIFACT_NAME}\ngh run download --name $ARTIFACT_NAME --dir rollback\ntar -xzf rollback/${ARTIFACT_NAME}.tar.gz -C rollback\ncd rollback && ./rollback.sh\n\`\`\`\n            `;\n            await github.rest.issues.createComment({\n              owner: context.repo.owner,\n              repo: context.repo.repo,\n              issue_number: issueNumber,\n              body: commentBody.trim()\n            });\n\n  post-deployment:\n    needs: rollback-preparation\n    runs-on: ubuntu-latest\n    steps:\n      - name: Update Issue and Close\n        uses: actions/github-script@v7\n        with:\n          script: |\n            const issueNumber = ${{ needs.pre-deployment.outputs.issue-number }};\n            const { ARTIFACT_NAME, SHA256_CHECKSUM } = process.env;\n            await github.rest.issues.removeLabel({\n              owner: context.repo.owner,\n              repo: context.repo.repo,\n              issue_number: issueNumber,\n              name: 'in-progress'\n            });\n            await github.rest.issues.addLabels({\n              owner: context.repo.owner,\n              repo: context.repo.repo,\n              issue_number: issueNumber,\n              labels: ['completed']\n            });\n            await github.rest.issues.createComment({\n              owner: context.repo.owner,\n              repo: context.repo.repo,\n              issue_number: issueNumber,\n              body: `## âœ… Deployment Completed\nRollback artifact: \`${ARTIFACT_NAME}.tar.gz\` (SHA256: \`${SHA256_CHECKSUM}\`)`\n            });\n            await github.rest.issues.update({\n              owner: context.repo.owner,\n              repo: context.repo.repo,\n              issue_number: issueNumber,\n              state: 'closed'\n            });\n